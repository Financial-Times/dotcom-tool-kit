// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`circleci-deploy config integration test should generate a .circleci/config.yml with the base config from circleci-deploy/.toolkitrc.yml 1`] = `
"version: 2.1
executors:
  base:
    docker:
      - image: cimg/base:stable
  node:
    docker:
      - image: cimg/node:20.19-browsers
jobs:
  checkout:
    executor: base
    steps:
      - attach_workspace:
          at: .
      - checkout
      - persist_to_workspace:
          root: .
          paths:
            - .
  setup:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - node/install-packages
      - persist_to_workspace:
          root: .
          paths:
            - .
  build:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - run:
          name: build
          command: npx dotcom-tool-kit build:ci
      - persist_to_workspace:
          root: .
          paths:
            - .
  test:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - run:
          name: test
          command: npx dotcom-tool-kit test:ci
      - store_test_results:
          path: test-results
      - store_artifacts:
          path: test-results
          destination: test-results
      - persist_to_workspace:
          root: .
          paths:
            - .toolkitstate
  deploy-review:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - run:
          name: deploy-review
          command: npx dotcom-tool-kit deploy:review
      - persist_to_workspace:
          root: .
          paths:
            - .toolkitstate
  deploy-staging:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - run:
          name: deploy-staging
          command: npx dotcom-tool-kit deploy:staging
      - persist_to_workspace:
          root: .
          paths:
            - .toolkitstate
  e2e-test-review:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - run:
          name: e2e-test-review
          command: npx dotcom-tool-kit test:review
      - persist_to_workspace:
          root: .
          paths:
            - .toolkitstate
  e2e-test-staging:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - run:
          name: e2e-test-staging
          command: npx dotcom-tool-kit test:staging
      - persist_to_workspace:
          root: .
          paths:
            - .toolkitstate
  deploy-production:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - setup_remote_docker:
          docker_layer_caching: true
      - run:
          name: deploy-production
          command: npx dotcom-tool-kit deploy:production
      - change-api/change-log:
          environment: production
          system-code: << parameters.system-code >>
  teardown-review:
    executor: node
    steps:
      - attach_workspace:
          at: .
      - run:
          name: teardown-review
          command: npx dotcom-tool-kit teardown:review
    environment:
      CIRCLE_BRANCH: << pipeline.event.github.pull_request.head.ref >>
workflows:
  tool-kit:
    jobs:
      - checkout:
          requires: []
          filters:
            tags:
              only: /^v\\d+\\.\\d+\\.\\d+(-.+)?/
      - setup:
          requires:
            - checkout
          filters:
            tags:
              only: /^v\\d+\\.\\d+\\.\\d+(-.+)?/
      - build:
          requires:
            - setup
          filters:
            tags:
              only: /^v\\d+\\.\\d+\\.\\d+(-.+)?/
      - test:
          requires:
            - build
          filters:
            tags:
              only: /^v\\d+\\.\\d+\\.\\d+(-.+)?/
      - deploy-review:
          requires:
            - build
          filters:
            branches:
              ignore: main
      - deploy-staging:
          requires:
            - build
          filters:
            tags:
              only: /^v\\d+\\.\\d+\\.\\d+(-.+)?/
            branches:
              only: main
      - e2e-test-review:
          requires:
            - deploy-review
      - e2e-test-staging:
          requires:
            - deploy-staging
          filters:
            tags:
              only: /^v\\d+\\.\\d+\\.\\d+(-.+)?/
      - deploy-production:
          requires:
            - test
            - e2e-test-staging
          filters:
            tags:
              only: /^v\\d+\\.\\d+\\.\\d+(-.+)?/
            branches:
              only: main
    when: pipeline.trigger_source != "scheduled_pipeline"
  nightly:
    jobs:
      - checkout:
          requires: []
      - setup:
          requires:
            - checkout
      - build:
          requires:
            - setup
      - test:
          requires:
            - build
      - deploy-review:
          requires:
            - build
          filters:
            branches:
              ignore: main
    when: |
      pipeline.trigger_source == "scheduled_pipeline" and
      pipeline.schedule.name == "nightly"
  pr-close:
    jobs:
      - checkout:
          requires: []
      - setup:
          requires:
            - checkout
      - teardown-review:
          requires:
            - setup
    when: >
      pipeline.trigger_source != "scheduled_pipeline" and

      (pipeline.event.name == "pull_request" and pipeline.event.action ==
      "closed")
orbs:
  node: circleci/node@5.0.2
  change-api: financial-times/change-api@1.0.9
  cloudsmith-oidc: ft-circleci-orbs/cloudsmith-oidc@1.0
  aws-cli: circleci/aws-cli@3.1.4
  serverless-framework: circleci/serverless-framework@2.0.2
"
`;
